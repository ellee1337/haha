-- üç≥ Auto Restaurant Script + Rayfield UI
-- Made by cookie codes

-- ‚öôÔ∏è Load Rayfield UI
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

-- ‚öôÔ∏è Services
local player = game.Players.LocalPlayer
local replicatedStorage = game:GetService("ReplicatedStorage")
local taskEvent = replicatedStorage:WaitForChild("Events"):WaitForChild("Restaurant"):WaitForChild("TaskCompleted")
local playerGui = player:WaitForChild("PlayerGui")

-- ‚öôÔ∏è Settings
getgenv().Settings = {
    AutoCustomer = false,
    PickupCash = false,
    PickupDishes = false,
    InstantCook = false
}

------------------------------------------------------------
-- ‚öôÔ∏è Core Functions
------------------------------------------------------------

local function getTycoon()
    for _, tycoon in pairs(workspace.Tycoons:GetChildren()) do
        for _, v in pairs(tycoon:GetChildren()) do
            if v:IsA("ObjectValue") and v.Value == player then
                return tycoon
            end
        end
    end
    return nil
end

local function ActionRemote(Type, Model, tycoon)
    local args = {
        ["Tycoon"] = tycoon,
        ["Name"] = Type,
        ["FurnitureModel"] = Model
    }
    taskEvent:FireServer(args)
end

local function processCustomerRequests()
    local tycoon = getTycoon()
    if not tycoon then return end

    local surface = tycoon.Items.Surface
    local tables = {}
    for _, model in pairs(surface:GetChildren()) do
        if model.Name:match("^T%d+$") then
            table.insert(tables, model)
        end
    end

    for _, ui in pairs(playerGui:GetChildren()) do
        if ui.Name == "CustomerSpeechUI" and ui.Adornee then
            for _, desc in pairs(ui:GetDescendants()) do
                if desc.Name == "Header" and desc:IsA("TextLabel") then
                    local groupSize = tonumber(string.match(desc.Text, "A table for (%d+), please%."))
                    if groupSize then
                        local customerModel = ui.Adornee:FindFirstAncestorOfClass("Model")
                        if customerModel then
                            for _, tableModel in pairs(tables) do
                                taskEvent:FireServer({
                                    ["FurnitureModel"] = tableModel,
                                    ["Tycoon"] = tycoon,
                                    ["Name"] = "SendToTable",
                                    ["GroupId"] = customerModel.Parent.Name
                                })
                            end
                        end
                    end
                end
            end
        end
    end
end

local function collectBills(tycoon)
    local surface = tycoon.Items.Surface
    for _, model in pairs(surface:GetChildren()) do
        if model:FindFirstChild("Bill") then
            ActionRemote("CollectBill", model, tycoon)
            task.wait(0.1)
        end
    end
end

local function collectDishes(tycoon)
    local surface = tycoon.Items.Surface
    for _, model in pairs(surface:GetChildren()) do
        if model:FindFirstChild("Trash") then
            ActionRemote("CollectDishes", model, tycoon)
            task.wait(0.1)
        end
    end
end

local function instantCook()
    while task.wait() and getgenv().Settings.InstantCook do
        for i = 1, 5 do
            replicatedStorage:WaitForChild("Events")
                :WaitForChild("Cook")
                :WaitForChild("CookInputRequested")
                :FireServer("Interact", workspace, "Oven")
        end
    end
end

------------------------------------------------------------
-- üéõÔ∏è Rayfield UI Setup
------------------------------------------------------------

local Window = Rayfield:CreateWindow({
    Name = "üçΩÔ∏è Auto Restaurant System",
    LoadingTitle = "Loading Automation Hub",
    LoadingSubtitle = "by cookie codes",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "RestaurantAuto",
        FileName = "Settings"
    }
})

local MainTab = Window:CreateTab("Main", 4483362458)

MainTab:CreateToggle({
    Name = "Auto Serve Customers",
    CurrentValue = getgenv().Settings.AutoCustomer,
    Flag = "AutoCustomer",
    Callback = function(Value)
        getgenv().Settings.AutoCustomer = Value
    end
})

MainTab:CreateToggle({
    Name = "Auto Collect Cash",
    CurrentValue = getgenv().Settings.PickupCash,
    Flag = "PickupCash",
    Callback = function(Value)
        getgenv().Settings.PickupCash = Value
    end
})

MainTab:CreateToggle({
    Name = "Auto Collect Dishes",
    CurrentValue = getgenv().Settings.PickupDishes,
    Flag = "PickupDishes",
    Callback = function(Value)
        getgenv().Settings.PickupDishes = Value
    end
})

MainTab:CreateToggle({
    Name = "Instant Cook (Fast Oven)",
    CurrentValue = getgenv().Settings.InstantCook,
    Flag = "InstantCook",
    Callback = function(Value)
        getgenv().Settings.InstantCook = Value
        if Value then
            task.spawn(instantCook)
        end
    end
})

------------------------------------------------------------
-- üîÅ Main Automation Loop
------------------------------------------------------------
coroutine.wrap(function()
    while task.wait(1) do
        local tycoon = getTycoon()
        if tycoon then
            if getgenv().Settings.AutoCustomer then
                processCustomerRequests()
            end
            if getgenv().Settings.PickupCash then
                collectBills(tycoon)
            end
            if getgenv().Settings.PickupDishes then
                collectDishes(tycoon)
            end
        else
            warn("‚ö†Ô∏è Could not find your tycoon!")
        end
    end
end)()
